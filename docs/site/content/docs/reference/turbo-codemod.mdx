---
title: '@turbo/codemod'
description: Turborepo가 코드모드를 사용하여 버전 마이그레이션을 쉽게 만드는 방법에 대해 알아봅니다.
---

import { Tabs, Tab } from '#components/tabs';
import { Callout } from '#components/callout';
import { Accordion, Accordions } from '#components/accordion';

Turborepo는 기능이 더 이상 사용되지 않을 때 Turborepo 코드베이스를 업그레이드하는 데 도움이 되는 코드모드 변환 및 자동 마이그레이션 스크립트를 제공합니다.

코드모드는 코드베이스에서 프로그래밍 방식으로 실행되는 변환입니다. 이를 통해 반복적인 변경 사항을 수동으로 관리하지 않고도 대량의 변경 사항을 적용할 수 있습니다.

## 사용법

먼저 패키지 매니저의 install 명령을 실행했는지 확인하세요.

```bash title="Terminal"
npx @turbo/codemod [transform] [path] [--dry] [--print]
```

- `transform` - 변환 이름, 아래에서 사용 가능한 변환을 참조하세요.
- `path` - 변환할 파일 또는 디렉토리
- `--dry` - 드라이 런 수행(코드가 편집되지 않음)
- `--print` - 비교를 위해 변경된 출력을 출력합니다

## Turborepo 버전 업그레이드

대부분의 경우 다음을 실행할 수 있습니다:

```bash title="Terminal"
npx @turbo/codemod
```

업그레이드에 필요한 모든 코드모드가 자동으로 실행됩니다.

### Turborepo 2.x

아래 코드모드는 Turborepo의 두 번째 주요 버전에서 마이그레이션 경로에 사용됩니다.

<Accordions>

<Accordion title="update-schema-json-url (2.0.0)" id="update-schema-json-url">

버전이 지정된 schema.json URL을 v2로 업데이트합니다.

```bash title="Terminal"
npx @turbo/codemod update-schema-json-url
```

**예시**

```diff title="./turbo.json"
{
- "$schema": "https://turborepo.com/schema.v1.json",
+ "$schema": "https://turborepo.com/schema.v2.json",
}
```

</Accordion>

<Accordion title="add-package-names (2.0.0)" id="add-package-names">

이름이 없는 모든 패키지의 `package.json`에 이름을 추가합니다.

```bash title="Terminal"
npx @turbo/codemod add-package-names
```

**예시**

```diff title="./packages/ui/package.json"
{
+ "name": "@repo/ui",
}
```

</Accordion>

<Accordion title="clean-globs (2.0.0)" id="clean-globs">

`turbo`의 glob 처리 변경으로 인해 유효하지 않은 glob 패턴을 수정합니다.

```bash title="Terminal"
npx @turbo/codemod clean-globs
```

**예시**

```diff title="./turbo.json"
{
  "tasks": {
    "build": {
      "outputs": [
        // 연속된 이중 별표를 축소
-         "**/**.ext", // [!code highlight]
+         "**.ext" // [!code highlight]
        // 파일 확장자에 이중 별표가 없도록 보장
-         "**.ext", // [!code highlight]
+         "**/*.ext" // [!code highlight]
        // 디렉토리 이름의 적절한 확장
-         "prefix**/", // [!code highlight]
+         "prefix*/**" // [!code highlight]
      ]
    }
  }
}
```

</Accordion>

<Accordion title="migrate-dot-env (2.0.0)" id="migrate-dot-env">

제거된 `dotEnv` 키에서 `inputs`로 `.env` 파일을 이동합니다.

```bash title="Terminal"
npx @turbo/codemod migrate-dot-env
```

**예시**

```diff title="./turbo.json"
{
  "tasks": {
    "build": {
-       "dotEnv": [".env"], // [!code highlight]
      "inputs": [
        "dist/**",
+         ".env" // [!code highlight]
      ],
    }
  }
}
```

</Accordion>

<Accordion title="rename-output-mode (2.0.0)" id="rename-output-mode">

`outputMode` 키를 `outputLogs`로 이름을 변경합니다.

```bash title="Terminal"
npx @turbo/codemod rename-output-mode
```

**예시**

```diff title="./turbo.json"
{
  "tasks": {
    "build": {
-     "outputMode": "errors-only" // [!code highlight]
+     "outputLogs": "errors-only" // [!code highlight]
    }
  }
}
```

</Accordion>

<Accordion title="rename-pipeline (2.0.0)" id="rename-pipeline">

`pipeline` 키를 `tasks`로 이름을 변경합니다.

```bash title="Terminal"
npx @turbo/codemod rename-pipeline
```

**예시**

```diff title="./turbo.json"
{
- "pipeline": {
+ "tasks": {
    "build": {
      ...
    },
    "dev": {
      ...
    },
    "lint": {
      ...
    }
  }
}
```

</Accordion>

<Accordion title="stabilize-ui (2.0.0)" id="stabilize-ui">

`turbo.json`의 `experimentalUI` 키를 `ui`로 이름을 변경합니다.

```bash title="Terminal"
npx @turbo/codemod stabilize-ui
```

**예시**

```diff title="./turbo.json"
{
- "experimentalUI": true
+ "ui": true
}
```

</Accordion>
</Accordions>

### Turborepo 1.x

아래 코드모드는 Turborepo의 첫 번째 주요 버전에서 마이그레이션 경로에 사용됩니다.

<Accordions>
<Accordion title="stabilize-env-mode (1.10.0)" id="stabilize-env-mode">

`turbo.json`의 `experimentalGlobalPassThroughEnv`를 `globalPassThroughEnv`로, `experimentalPassThroughEnv`를 `passThroughEnv`로 마이그레이션합니다.

```bash title="Terminal"
npx @turbo/codemod stabilize-env-mode
```

**예시**

```diff title="./turbo.json"
{
  "$schema": "https://turborepo.com/schema.json",
- "experimentalGlobalPassThroughEnv": ["CC"],
+ "globalPassThroughEnv": ["CC"],
  "pipeline": {
    "build": {
-     "experimentalPassThroughEnv": ["GOROOT"],
+     "passThroughEnv": ["GOROOT"],
    }
  }
}
```

</Accordion>
<Accordion title="transform-env-literals-to-wildcards (1.10.0)" id="transform-env-literals-to-wildcards">

새로운 와일드카드 구문에 모호할 수 있는 내용이 있는 기존 환경 변수 필드를 업데이트합니다.

```bash title="Terminal"
npx @turbo/codemod transform-env-literals-to-wildcards
```

**예시**

```diff title="./turbo.json"
{
  "$schema": "https://turborepo.com/schema.json",
- "globalEnv": ["THIS_*_IS_LITERAL"],
- "globalPassThroughEnv": ["!LITERAL_LEADING_EXCLAMATION"],
+  "globalEnv": ["THIS_\\*_IS_LITERAL"],
+  "globalPassThroughEnv": ["\\!LITERAL_LEADING_EXCLAMATION"],
  "pipeline": {
    "build": {
-     "env": ["50_PERCENT_OFF*_HAS_SMALL_PRINT"],
-     "passThroughEnv": ["**BOLDED**"],
+     "env": ["50_PERCENT_OFF\\*_HAS_SMALL_PRINT"],
+     "passThroughEnv": ["\\*\\*BOLDED\\*\\*"],
    }
  }
}
```

</Accordion>
<Accordion title="set-default-outputs (1.7.0)" id="set-default-outputs">

`turbo.json` outputs을 이전에 추론된 `dist/**` 및 `build/**`를 포함하도록 마이그레이션합니다.

```bash title="Terminal"
npx @turbo/codemod set-default-outputs
```

**예시**

```diff title="turbo.json"
{
  "$schema": "https://turborepo.com/schema.json",
  "globalDependencies": [".env"],
  "globalEnv": ["CI_ENV"],
  "pipeline": {
    "build": {
      "dependsOn": ["^build"],
      "env": ["API_BASE"],
      "outputs": [".next/**", "!.next/cache/**"]
    },
-   "lint": {
-     "outputs": []
-    },
+   "lint": {},
    "dev": {
      "cache": false,
      "persistent": true,
+     "outputs": ["dist/**", "build/**"]
    }
  }
}

```

</Accordion>

<Accordion title="migrate-env-var-dependencies (1.5.0)" id="migrate-env-var-dependencies">

`turbo.json`의 모든 환경 변수 종속성을 `dependsOn` 및 `globalDependencies`에서 각각 `env` 및 `globalEnv`로 마이그레이션합니다.

```bash title="Terminal"
npx @turbo/codemod migrate-env-var-dependencies
```

**예시**

```diff title="./turbo.json"
// After, turbo.json
{
  "$schema": "https://turborepo.com/schema.json",
- "globalDependencies": [".env", "$CI_ENV"],
+ "globalDependencies": [".env"],
+ "globalEnv": ["CI_ENV"],
  "pipeline": {
    "build": {
-     "dependsOn": ["^build", "$API_BASE"],
+     "dependsOn": ["^build"],
+     "env": ["API_BASE"],
      "outputs": [".next/**", "!.next/cache/**"],
    },
    "lint": {},
    "dev": {
      "cache": false,
      "persistent": true
    }
  }
}
```

</Accordion>
<Accordion title="add-package-manager (1.1.0)" id="add-package-manager">
루트 `package.json`을 변환하여 `packageManager` 키가 감지된 패키지 매니저(`yarn`, `npm`, `pnpm`) 및 버전(예: `yarn@1.22.17`)으로 설정되도록 합니다. 이 키는 이제 [Node.js에서 지원](https://nodejs.org/dist/latest-v17.x/docs/api/packages.html#packagemanager)되며 Turborepo에서 더 빠른 패키지 매니저 감지에 사용됩니다(파일 시스템만으로 추론하는 것 대비).

```bash title="Terminal"
npx @turbo/codemod add-package-manager
```

**예시**

```diff title="./package.json"
{
  "name": "turborepo-basic",
  "version": "0.0.0",
  "private": true,
+  "packageManager": "yarn@1.22.17",
  "workspaces": [
    "apps/*",
    "packages/*"
  ]
}
```

</Accordion>

<Accordion title="create-turbo-config (1.1.0)" id="create-turbo-config">

`package.json`의 `"turbo"` 키를 기반으로 프로젝트 루트에 `turbo.json` 파일을 생성합니다.
그런 다음 `package.json`에서 `"turbo"` 키가 삭제됩니다.

```bash title="Terminal"
npx @turbo/codemod create-turbo-config
```

**예시**

<Tabs items={["package.json", "turbo.json"]}>
<Tab value="package.json">
```diff title="./package.json"
// After, package.json
{
  "name": "@acme/workspace",
  "private": true,
- "turbo": {
-   "pipeline": {
-     ...
-   }
- },
}
```
</Tab>
<Tab value="turbo.json">
```diff title="./turbo.json"
+ {
+   "$schema": "https://turborepo.com/schema.json",
+   "pipeline": {
+     ...
+   }
+ }
```
</Tab>

</Tabs>

</Accordion>
</Accordions>
